<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack Casino - Juego Completo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0c5230 0%, #1a4d3a 50%, #0c5230 100%);
            min-height: 100vh;
            color: white;
            overflow-x: auto;
        }

        .casino-table {
            background: radial-gradient(ellipse at center, #2a7c4f 0%, #1a4d3a 70%);
            border: 8px solid #8B4513;
            border-radius: 200px;
            width: 95%;
            max-width: 1200px;
            margin: 20px auto;
            padding: 30px;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            position: relative;
        }

        .game-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .game-title {
            font-size: 2.5em;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            margin-bottom: 10px;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .balance {
            color: #90EE90;
            font-weight: bold;
        }

        .deck-area {
            position: absolute;
            top: 20px;
            right: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .deck {
            width: 60px;
            height: 84px;
            background: #000080;
            border: 2px solid #FFD700;
            border-radius: 8px;
            position: relative;
            margin-bottom: 10px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .deck:hover {
            transform: scale(1.1);
        }

        .deck::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            width: 60px;
            height: 84px;
            background: #000080;
            border: 2px solid #FFD700;
            border-radius: 8px;
        }

        .deck::after {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            width: 60px;
            height: 84px;
            background: #000080;
            border: 2px solid #FFD700;
            border-radius: 8px;
        }

        .cards-left {
            color: #FFD700;
            font-size: 0.9em;
            text-align: center;
        }

        .betting-area {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
        }

        .bet-spot {
            background: rgba(255,215,0,0.1);
            border: 3px dashed #FFD700;
            border-radius: 50%;
            width: 120px;
            height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .bet-spot:hover {
            background: rgba(255,215,0,0.2);
            transform: scale(1.05);
        }

        .bet-spot.active {
            border-color: #32CD32;
            background: rgba(50,205,50,0.2);
        }

        .bet-label {
            font-size: 0.8em;
            font-weight: bold;
            color: #FFD700;
            text-align: center;
            margin-bottom: 5px;
        }

        .bet-amount {
            font-size: 1.1em;
            color: #90EE90;
            font-weight: bold;
        }

        .payout-info {
            font-size: 0.7em;
            color: #FFA500;
            text-align: center;
            margin-top: 5px;
        }

        .chip-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .chip {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8em;
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
        }

        .chip:hover {
            transform: scale(1.1);
        }

        .chip-1 { background: #FF6B6B; border-color: #FF4757; color: white; }
        .chip-5 { background: #4ECDC4; border-color: #26D0CE; color: white; }
        .chip-25 { background: #45B7D1; border-color: #3742FA; color: white; }
        .chip-100 { background: #FFA726; border-color: #FF9F43; color: white; }
        .chip-500 { background: #9C88FF; border-color: #8E44AD; color: white; }

        .game-area {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .dealer-area, .player-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .hand-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.2em;
        }

        .hand-value {
            background: rgba(0,0,0,0.7);
            padding: 5px 15px;
            border-radius: 20px;
            color: #FFD700;
            font-weight: bold;
        }

        .cards-container {
            display: flex;
            gap: -20px;
            justify-content: center;
            min-height: 120px;
            align-items: center;
        }

        .card {
            width: 80px;
            height: 112px;
            background: white;
            border: 2px solid #333;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 8px;
            margin-left: -15px;
            transition: all 0.5s ease;
            transform-style: preserve-3d;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .card:first-child {
            margin-left: 0;
        }

        .card.dealing {
            animation: dealCard 0.5s ease-out;
        }

        .card.face-down {
            background: #000080;
            color: #FFD700;
        }

        .card.face-down::before {
            content: '🂠';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
        }

        .card-value {
            font-size: 1em;
            font-weight: bold;
        }

        .card-suit {
            font-size: 2em;
            align-self: center;
        }

        .red { color: #FF0000; }
        .black { color: #000000; }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #FF9800, #F57C00);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: white;
        }

        .message-area {
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .message {
            font-size: 1.3em;
            font-weight: bold;
            padding: 15px 30px;
            border-radius: 25px;
            background: rgba(0,0,0,0.7);
            display: inline-block;
            animation: pulse 2s infinite;
        }

        .message.win {
            color: #4CAF50;
            border: 2px solid #4CAF50;
        }

        .message.lose {
            color: #f44336;
            border: 2px solid #f44336;
        }

        .message.push {
            color: #FFA500;
            border: 2px solid #FFA500;
        }

        .message.blackjack {
            color: #FFD700;
            border: 2px solid #FFD700;
        }

        @keyframes dealCard {
            from {
                transform: translateX(200px) rotate(180deg) scale(0);
                opacity: 0;
            }
            to {
                transform: translateX(0) rotate(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes shuffle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
        }

        .shuffle-animation {
            animation: shuffle 0.5s ease-in-out 3;
        }

        .statistics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #FFD700;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #90EE90;
        }

        @media (max-width: 768px) {
            .casino-table {
                width: 98%;
                padding: 15px;
            }
            
            .game-title {
                font-size: 1.8em;
            }
            
            .betting-area {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .bet-spot {
                width: 100px;
                height: 100px;
            }
            
            .card {
                width: 60px;
                height: 84px;
                margin-left: -10px;
            }
            
            .controls {
                gap: 10px;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="casino-table">
        <div class="game-header">
            <h1 class="game-title">🎰 BLACKJACK CASINO 🎰</h1>
            <div class="game-info">
                <div class="balance">💰 Balance: $<span id="balance">10000</span></div>
                <div>🏆 Sesión: $<span id="session">0</span></div>
                <div>🃏 Juegos: <span id="games-played">0</span></div>
            </div>
        </div>

        <div class="deck-area">
            <div class="deck" id="deck" title="Mezclar nuevas cartas"></div>
            <div class="cards-left">
                Cartas: <span id="cards-remaining">416</span>
            </div>
        </div>

        <div class="betting-area">
            <div class="bet-spot" data-bet="main">
                <div class="bet-label">BLACKJACK</div>
                <div class="bet-amount">$<span>0</span></div>
                <div class="payout-info">3:2</div>
            </div>
            <div class="bet-spot" data-bet="insurance">
                <div class="bet-label">SEGURO</div>
                <div class="bet-amount">$<span>0</span></div>
                <div class="payout-info">2:1</div>
            </div>
            <div class="bet-spot" data-bet="21plus3">
                <div class="bet-label">21+3</div>
                <div class="bet-amount">$<span>0</span></div>
                <div class="payout-info">9:1</div>
            </div>
            <div class="bet-spot" data-bet="perfect-pairs">
                <div class="bet-label">PARES PERFECTOS</div>
                <div class="bet-amount">$<span>0</span></div>
                <div class="payout-info">25:1</div>
            </div>
            <div class="bet-spot" data-bet="bust-bonus">
                <div class="bet-label">BUST BONUS</div>
                <div class="bet-amount">$<span>0</span></div>
                <div class="payout-info">5:2</div>
            </div>
            <div class="bet-spot" data-bet="lucky-lucky">
                <div class="bet-label">LUCKY LUCKY</div>
                <div class="bet-amount">$<span>0</span></div>
                <div class="payout-info">200:1</div>
            </div>
        </div>

        <div class="chip-selector">
            <div class="chip chip-1" data-value="1">$1</div>
            <div class="chip chip-5" data-value="5">$5</div>
            <div class="chip chip-25" data-value="25">$25</div>
            <div class="chip chip-100" data-value="100">$100</div>
            <div class="chip chip-500" data-value="500">$500</div>
        </div>

        <div class="game-area">
            <div class="dealer-area">
                <div class="hand-info">
                    <span>🎩 DEALER</span>
                    <div class="hand-value" id="dealer-value">0</div>
                </div>
                <div class="cards-container" id="dealer-cards"></div>
            </div>

            <div class="player-area">
                <div class="hand-info">
                    <span>👤 JUGADOR</span>
                    <div class="hand-value" id="player-value">0</div>
                </div>
                <div class="cards-container" id="player-cards"></div>
            </div>
        </div>

        <div class="message-area">
            <div class="message" id="game-message" style="display: none;">¡Haz tu apuesta para comenzar!</div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" id="deal-btn">REPARTIR</button>
            <button class="btn btn-secondary" id="hit-btn" disabled>PEDIR</button>
            <button class="btn btn-warning" id="stand-btn" disabled>PLANTARSE</button>
            <button class="btn btn-secondary" id="double-btn" disabled>DOBLAR</button>
            <button class="btn btn-secondary" id="split-btn" disabled>DIVIDIR</button>
            <button class="btn btn-danger" id="clear-bets-btn">LIMPIAR</button>
        </div>

        <div class="statistics">
            <div class="stat-item">
                <div class="stat-label">Partidas Ganadas</div>
                <div class="stat-value" id="wins">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Partidas Perdidas</div>
                <div class="stat-value" id="losses">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Empates</div>
                <div class="stat-value" id="pushes">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Blackjacks</div>
                <div class="stat-value" id="blackjacks">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">% Victorias</div>
                <div class="stat-value" id="win-rate">0%</div>
            </div>
        </div>
    </div>

    <script>
        class BlackjackGame {
            constructor() {
                this.balance = 10000;
                this.sessionWinnings = 0;
                this.gamesPlayed = 0;
                this.wins = 0;
                this.losses = 0;
                this.pushes = 0;
                this.blackjacks = 0;
                
                this.selectedChip = 5;
                this.bets = {
                    main: 0,
                    insurance: 0,
                    '21plus3': 0,
                    'perfect-pairs': 0,
                    'bust-bonus': 0,
                    'lucky-lucky': 0
                };
                
                this.deck = [];
                this.playerHand = [];
                this.dealerHand = [];
                this.gameActive = false;
                this.playerTurn = false;
                this.dealerHoleCard = null;
                
                this.suits = ['♠', '♥', '♦', '♣'];
                this.ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
                
                this.initializeDeck();
                this.bindEvents();
                this.updateDisplay();
                this.showMessage('¡Haz tu apuesta para comenzar!', '');
            }
            
            initializeDeck() {
                this.deck = [];
                // 8 mazos
                for (let deck = 0; deck < 8; deck++) {
                    for (let suit of this.suits) {
                        for (let rank of this.ranks) {
                            this.deck.push({
                                suit: suit,
                                rank: rank,
                                value: this.getCardValue(rank)
                            });
                        }
                    }
                }
                this.shuffleDeck();
                this.updateCardsRemaining();
            }
            
            shuffleDeck() {
                const deckElement = document.getElementById('deck');
                deckElement.classList.add('shuffle-animation');
                
                setTimeout(() => {
                    for (let i = this.deck.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [this.deck[i], this.deck[j]] = [this.deck[j], this.deck[i]];
                    }
                    deckElement.classList.remove('shuffle-animation');
                }, 1500);
            }
            
            getCardValue(rank) {
                if (rank === 'A') return 11;
                if (['K', 'Q', 'J'].includes(rank)) return 10;
                return parseInt(rank);
            }
            
            dealCard() {
                if (this.deck.length < 52) {
                    this.initializeDeck();
                    this.showMessage('¡Mezclando nuevas cartas!', '');
                }
                this.updateCardsRemaining();
                return this.deck.pop();
            }
            
            calculateHandValue(hand) {
                let value = 0;
                let aces = 0;
                
                for (let card of hand) {
                    if (card.rank === 'A') {
                        aces++;
                        value += 11;
                    } else {
                        value += card.value;
                    }
                }
                
                while (value > 21 && aces > 0) {
                    value -= 10;
                    aces--;
                }
                
                return value;
            }
            
            displayCard(card, container, faceDown = false) {
                const cardElement = document.createElement('div');
                cardElement.className = 'card dealing';
                
                if (faceDown) {
                    cardElement.classList.add('face-down');
                } else {
                    const suitColor = ['♥', '♦'].includes(card.suit) ? 'red' : 'black';
                    cardElement.innerHTML = `
                        <div class="card-value ${suitColor}">${card.rank}</div>
                        <div class="card-suit ${suitColor}">${card.suit}</div>
                        <div class="card-value ${suitColor}" style="transform: rotate(180deg);">${card.rank}</div>
                    `;
                }
                
                container.appendChild(cardElement);
                
                setTimeout(() => {
                    cardElement.classList.remove('dealing');
                }, 500);
            }
            
            revealHoleCard() {
                const dealerCards = document.getElementById('dealer-cards');
                const holeCard = dealerCards.children[1];
                
                if (holeCard && holeCard.classList.contains('face-down')) {
                    const card = this.dealerHoleCard;
                    const suitColor = ['♥', '♦'].includes(card.suit) ? 'red' : 'black';
                    
                    holeCard.classList.remove('face-down');
                    holeCard.innerHTML = `
                        <div class="card-value ${suitColor}">${card.rank}</div>
                        <div class="card-suit ${suitColor}">${card.suit}</div>
                        <div class="card-value ${suitColor}" style="transform: rotate(180deg);">${card.rank}</div>
                    `;
                }
            }
            
            bindEvents() {
                // Seleccionar fichas
                document.querySelectorAll('.chip').forEach(chip => {
                    chip.addEventListener('click', (e) => {
                        document.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
                        e.target.classList.add('selected');
                        this.selectedChip = parseInt(e.target.dataset.value);
                    });
                });
                
                // Apostar
                document.querySelectorAll('.bet-spot').forEach(spot => {
                    spot.addEventListener('click', (e) => {
                        if (this.gameActive) return;
                        
                        const betType = e.currentTarget.dataset.bet;
                        if (this.balance >= this.selectedChip) {
                            this.bets[betType] += this.selectedChip;
                            this.balance -= this.selectedChip;
                            this.updateDisplay();
                            e.currentTarget.classList.add('active');
                        }
                    });
                });
                
                // Controles del juego
                document.getElementById('deal-btn').addEventListener('click', () => this.dealCards());
                document.getElementById('hit-btn').addEventListener('click', () => this.hit());
                document.getElementById('stand-btn').addEventListener('click', () => this.stand());
                document.getElementById('double-btn').addEventListener('click', () => this.double());
                document.getElementById('split-btn').addEventListener('click', () => this.split());
                document.getElementById('clear-bets-btn').addEventListener('click', () => this.clearBets());
                document.getElementById('deck').addEventListener('click', () => this.shuffleDeck());
            }
            
            dealCards() {
                if (this.bets.main === 0) {
                    this.showMessage('¡Debes hacer una apuesta principal!', 'lose');
                    return;
                }
                
                this.gameActive = true;
                this.playerTurn = true;
                this.playerHand = [];
                this.dealerHand = [];
                
                document.getElementById('player-cards').innerHTML = '';
                document.getElementById('dealer-cards').innerHTML = '';
                
                // Repartir cartas con animación
                setTimeout(() => {
                    // Primera carta del jugador
                    const card1 = this.dealCard();
                    this.playerHand.push(card1);
                    this.displayCard(card1, document.getElementById('player-cards'));
                }, 200);
                
                setTimeout(() => {
                    // Primera carta del dealer (visible)
                    const dealerCard1 = this.dealCard();
                    this.dealerHand.push(dealerCard1);
                    this.displayCard(dealerCard1, document.getElementById('dealer-cards'));
                }, 600);
                
                setTimeout(() => {
                    // Segunda carta del jugador
                    const card2 = this.dealCard();
                    this.playerHand.push(card2);
                    this.displayCard(card2, document.getElementById('player-cards'));
                }, 1000);
                
                setTimeout(() => {
                    // Segunda carta del dealer (oculta)
                    const dealerCard2 = this.dealCard();
                    this.dealerHand.push(dealerCard2);
                    this.dealerHoleCard = dealerCard2;
                    this.displayCard(dealerCard2, document.getElementById('dealer-cards'), true);
                    
                    this.updateHandValues();
                    this.checkInitialConditions();
                }, 1400);
            }
            
            checkInitialConditions() {
                const playerValue = this.calculateHandValue(this.playerHand);
                const dealerUpCard = this.dealerHand[0];
                
                // Verificar seguro
                if (dealerUpCard.rank === 'A' && this.bets.insurance === 0) {
                    // Opción de seguro automática si hay apuesta principal
                    if (this.bets.main > 0 && this.balance >= this.bets.main / 2) {
                        this.showMessage('¿Deseas seguro? (Haz clic en el spot de seguro)', '');
                    }
                }
                
                // Verificar blackjack del jugador
                if (playerValue === 21) {
                    this.checkForBlackjack();
                } else {
                    this.enablePlayerActions();
                    this.checkSideBets();
                }
            }
            
            checkForBlackjack() {
                const dealerValue = this.calculateHandValue(this.dealerHand);
                this.revealHoleCard();
                
                if (dealerValue === 21) {
                    this.showMessage('¡Empate! Ambos tienen Blackjack', 'push');
                    this.endRound('push');
                } else {
                    this.showMessage('¡BLACKJACK! ¡Ganaste!', 'blackjack');
                    this.blackjacks++;
                    this.endRound('blackjack');
                }
            }
            
            enablePlayerActions() {
                document.getElementById('hit-btn').disabled = false;
                document.getElementById('stand-btn').disabled = false;
                document.getElementById('deal-btn').disabled = true;
                
                // Doblar solo si tienes 2 cartas
                if (this.playerHand.length === 2 && this.balance >= this.bets.main) {
                    document.getElementById('double-btn').disabled = false;
                }
                
                // Dividir solo si tienes 2 cartas del mismo valor
                if (this.playerHand.length === 2 && 
                    this.playerHand[0].rank === this.playerHand[1].rank && 
                    this.balance >= this.bets.main) {
                    document.getElementById('split-btn').disabled = false;
                }
            }
            
            hit() {
                const card = this.dealCard();
                this.playerHand.push(card);
                this.displayCard(card, document.getElementById('player-cards'));
                
                setTimeout(() => {
                    this.updateHandValues();
                    const playerValue = this.calculateHandValue(this.playerHand);
                    
                    if (playerValue > 21) {
                        this.showMessage('¡Te pasaste! Dealer gana', 'lose');
                        this.endRound('lose');
                    } else if (playerValue === 21) {
                        this.stand();
                    } else {
                        // Deshabilitar doblar y dividir después del primer hit
                        document.getElementById('double-btn').disabled = true;
                        document.getElementById('split-btn').disabled = true;
                    }
                }, 500);
            }
            
            stand() {
                this.playerTurn = false;
                this.revealHoleCard();
                this.updateHandValues();
                
                setTimeout(() => {
                    this.dealerPlay();
                }, 1000);
            }
            
            double() {
                if (this.balance >= this.bets.main) {
                    this.balance -= this.bets.main;
                    this.bets.main *= 2;
                    this.updateDisplay();
                    
                    const card = this.dealCard();
                    this.playerHand.push(card);
                    this.displayCard(card, document.getElementById('player-cards'));
                    
                    setTimeout(() => {
                        this.updateHandValues();
                        const playerValue = this.calculateHandValue(this.playerHand);
                        
                        if (playerValue > 21) {
                            this.showMessage('¡Te pasaste! Dealer gana', 'lose');
                            this.endRound('lose');
                        } else {
                            this.stand();
                        }
                    }, 500);
                }
            }
            
            split() {
                // Implementación básica de split (se puede expandir)
                this.showMessage('Función de dividir en desarrollo', '');
            }
            
            dealerPlay() {
                const dealerValue = this.calculateHandValue(this.dealerHand);
                
                if (dealerValue < 17 || (dealerValue === 17 && this.isSoft17(this.dealerHand))) {
                    setTimeout(() => {
                        const card = this.dealCard();
                        this.dealerHand.push(card);
                        this.displayCard(card, document.getElementById('dealer-cards'));
                        
                        setTimeout(() => {
                            this.updateHandValues();
                            this.dealerPlay();
                        }, 500);
                    }, 800);
                } else {
                    this.resolveGame();
                }
            }
            
            isSoft17(hand) {
                let value = 0;
                let aces = 0;
                
                for (let card of hand) {
                    if (card.rank === 'A') aces++;
                    value += card.value;
                }
                
                return value === 17 && aces > 0 && this.calculateHandValue(hand) === 17;
            }
            
            resolveGame() {
                const playerValue = this.calculateHandValue(this.playerHand);
                const dealerValue = this.calculateHandValue(this.dealerHand);
                
                let result;
                let message;
                
                if (dealerValue > 21) {
                    result = 'win';
                    message = '¡Dealer se pasó! ¡Ganaste!';
                } else if (playerValue > dealerValue) {
                    result = 'win';
                    message = '¡Ganaste!';
                } else if (playerValue < dealerValue) {
                    result = 'lose';
                    message = '¡Dealer gana!';
                } else {
                    result = 'push';
                    message = '¡Empate!';
                }
                
                this.showMessage(message, result);
                this.endRound(result);
            }
            
            checkSideBets() {
                // 21+3 (Flush, Straight, Three of a Kind, Straight Flush)
                if (this.bets['21plus3'] > 0) {
                    const combo = this.check21Plus3();
                    if (combo.win) {
                        this.balance += this.bets['21plus3'] * combo.payout;
                        this.sessionWinnings += this.bets['21plus3'] * (combo.payout - 1);
                    }
                }
                
                // Perfect Pairs
                if (this.bets['perfect-pairs'] > 0) {
                    const pairResult = this.checkPerfectPairs();
                    if (pairResult.win) {
                        this.balance += this.bets['perfect-pairs'] * pairResult.payout;
                        this.sessionWinnings += this.bets['perfect-pairs'] * (pairResult.payout - 1);
                    }
                }
                
                // Lucky Lucky
                if (this.bets['lucky-lucky'] > 0) {
                    const luckyResult = this.checkLuckyLucky();
                    if (luckyResult.win) {
                        this.balance += this.bets['lucky-lucky'] * luckyResult.payout;
                        this.sessionWinnings += this.bets['lucky-lucky'] * (luckyResult.payout - 1);
                    }
                }
            }
            
            check21Plus3() {
                if (this.playerHand.length < 2 || this.dealerHand.length < 1) {
                    return { win: false, payout: 0 };
                }
                
                const cards = [this.playerHand[0], this.playerHand[1], this.dealerHand[0]];
                const suits = cards.map(c => c.suit);
                const ranks = cards.map(c => c.rank);
                
                // Flush
                const isFlush = suits.every(s => s === suits[0]);
                
                // Straight
                const rankValues = ranks.map(r => {
                    if (r === 'A') return 1;
                    if (r === 'J') return 11;
                    if (r === 'Q') return 12;
                    if (r === 'K') return 13;
                    return parseInt(r);
                }).sort((a, b) => a - b);
                
                const isStraight = (rankValues[2] - rankValues[1] === 1) && (rankValues[1] - rankValues[0] === 1);
                
                // Three of a kind
                const isThreeOfKind = ranks.every(r => r === ranks[0]);
                
                if (isFlush && isStraight) return { win: true, payout: 40 }; // Straight Flush
                if (isThreeOfKind) return { win: true, payout: 30 }; // Three of a Kind
                if (isStraight) return { win: true, payout: 10 }; // Straight
                if (isFlush) return { win: true, payout: 5 }; // Flush
                
                return { win: false, payout: 0 };
            }
            
            checkPerfectPairs() {
                if (this.playerHand.length < 2) {
                    return { win: false, payout: 0 };
                }
                
                const card1 = this.playerHand[0];
                const card2 = this.playerHand[1];
                
                if (card1.rank === card2.rank) {
                    if (card1.suit === card2.suit) {
                        return { win: true, payout: 25 }; // Perfect Pair
                    } else if (['♥', '♦'].includes(card1.suit) === ['♥', '♦'].includes(card2.suit)) {
                        return { win: true, payout: 12 }; // Colored Pair
                    } else {
                        return { win: true, payout: 6 }; // Mixed Pair
                    }
                }
                
                return { win: false, payout: 0 };
            }
            
            checkLuckyLucky() {
                if (this.playerHand.length < 2 || this.dealerHand.length < 1) {
                    return { win: false, payout: 0 };
                }
                
                const totalValue = this.calculateHandValue([this.playerHand[0], this.playerHand[1]]) + 
                                 this.dealerHand[0].value;
                
                if (totalValue === 19) return { win: true, payout: 2 };
                if (totalValue === 20) return { win: true, payout: 2 };
                if (totalValue === 21) return { win: true, payout: 3 };
                
                // Suited 777
                const cards = [this.playerHand[0], this.playerHand[1], this.dealerHand[0]];
                const allSevens = cards.every(c => c.rank === '7');
                const sameSuit = cards.every(c => c.suit === cards[0].suit);
                
                if (allSevens && sameSuit) return { win: true, payout: 200 };
                if (allSevens) return { win: true, payout: 50 };
                
                return { win: false, payout: 0 };
            }
            
            endRound(result) {
                this.gameActive = false;
                this.playerTurn = false;
                this.gamesPlayed++;
                
                // Resolver apuesta principal
                if (result === 'win') {
                    this.balance += this.bets.main * 2;
                    this.sessionWinnings += this.bets.main;
                    this.wins++;
                } else if (result === 'blackjack') {
                    this.balance += Math.floor(this.bets.main * 2.5);
                    this.sessionWinnings += Math.floor(this.bets.main * 1.5);
                    this.wins++;
                } else if (result === 'push') {
                    this.balance += this.bets.main;
                    this.pushes++;
                } else {
                    this.losses++;
                    this.sessionWinnings -= this.bets.main;
                }
                
                // Resolver seguro
                if (this.bets.insurance > 0) {
                    if (this.calculateHandValue(this.dealerHand) === 21) {
                        this.balance += this.bets.insurance * 3;
                        this.sessionWinnings += this.bets.insurance * 2;
                    } else {
                        this.sessionWinnings -= this.bets.insurance;
                    }
                }
                
                // Resolver Bust Bonus
                if (this.bets['bust-bonus'] > 0) {
                    const dealerValue = this.calculateHandValue(this.dealerHand);
                    if (dealerValue > 21) {
                        let payout = 2; // Base payout
                        if (dealerValue >= 22) payout = 2.5;
                        
                        this.balance += this.bets['bust-bonus'] * payout;
                        this.sessionWinnings += this.bets['bust-bonus'] * (payout - 1);
                    } else {
                        this.sessionWinnings -= this.bets['bust-bonus'];
                    }
                }
                
                this.resetForNextRound();
                this.updateDisplay();
                this.updateStatistics();
            }
            
            resetForNextRound() {
                // Limpiar apuestas
                for (let bet in this.bets) {
                    this.bets[bet] = 0;
                }
                
                // Restablecer controles
                document.getElementById('deal-btn').disabled = false;
                document.getElementById('hit-btn').disabled = true;
                document.getElementById('stand-btn').disabled = true;
                document.getElementById('double-btn').disabled = true;
                document.getElementById('split-btn').disabled = true;
                
                // Quitar estado activo de spots de apuestas
                document.querySelectorAll('.bet-spot').forEach(spot => {
                    spot.classList.remove('active');
                });
                
                setTimeout(() => {
                    this.showMessage('¡Haz tu apuesta para la siguiente ronda!', '');
                }, 3000);
            }
            
            clearBets() {
                if (this.gameActive) return;
                
                for (let bet in this.bets) {
                    this.balance += this.bets[bet];
                    this.bets[bet] = 0;
                }
                
                document.querySelectorAll('.bet-spot').forEach(spot => {
                    spot.classList.remove('active');
                });
                
                this.updateDisplay();
                this.showMessage('Apuestas limpiadas', '');
            }
            
            updateHandValues() {
                const playerValue = this.calculateHandValue(this.playerHand);
                const dealerValue = this.gameActive && this.playerTurn ? 
                    this.dealerHand[0].value : this.calculateHandValue(this.dealerHand);
                
                document.getElementById('player-value').textContent = playerValue;
                document.getElementById('dealer-value').textContent = dealerValue;
            }
            
            updateDisplay() {
                document.getElementById('balance').textContent = this.balance.toLocaleString();
                document.getElementById('session').textContent = this.sessionWinnings >= 0 ? 
                    '+' + this.sessionWinnings.toLocaleString() : this.sessionWinnings.toLocaleString();
                document.getElementById('games-played').textContent = this.gamesPlayed;
                
                // Actualizar montos de apuestas
                for (let bet in this.bets) {
                    const spot = document.querySelector(`[data-bet="${bet}"] .bet-amount span`);
                    if (spot) {
                        spot.textContent = this.bets[bet];
                    }
                }
            }
            
            updateCardsRemaining() {
                document.getElementById('cards-remaining').textContent = this.deck.length;
            }
            
            updateStatistics() {
                document.getElementById('wins').textContent = this.wins;
                document.getElementById('losses').textContent = this.losses;
                document.getElementById('pushes').textContent = this.pushes;
                document.getElementById('blackjacks').textContent = this.blackjacks;
                
                const totalGames = this.wins + this.losses + this.pushes;
                const winRate = totalGames > 0 ? Math.round((this.wins / totalGames) * 100) : 0;
                document.getElementById('win-rate').textContent = winRate + '%';
            }
            
            showMessage(text, type) {
                const messageEl = document.getElementById('game-message');
                messageEl.textContent = text;
                messageEl.className = `message ${type}`;
                messageEl.style.display = 'inline-block';
                
                if (type) {
                    setTimeout(() => {
                        messageEl.style.display = 'none';
                    }, 4000);
                }
            }
        }
        
        // Inicializar el juego cuando la página carga
        document.addEventListener('DOMContentLoaded', () => {
            new BlackjackGame();
        });
    </script>
</body>
</html>